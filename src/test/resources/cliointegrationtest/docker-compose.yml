version: '2'

services:
  pytest:
    build:
      context: ./
    environment:
      CLIO_HTTP_HOST: clio
      ELASTICSEARCH_HTTP_HOST: elasticsearch1
    volumes:
      - ./clio_test.py:/cliointegrationtest/clio_test.py:ro
    command:
      - /cliointegrationtest/clio_test.py
  clio:
    image: broadinstitute/clio:${CLIO_DOCKER_TAG}
    environment:
      clio.elasticsearch.http-hosts.0.hostname: elasticsearch1
  elasticsearch1:
    extends:
      file: elasticsearch-compose.yml
      service: elasticsearch
    volumes:
      - esdata1:/usr/share/elasticsearch/data
  elasticsearch2:
    extends:
      file: elasticsearch-compose.yml
      service: elasticsearch
    volumes:
      - esdata2:/usr/share/elasticsearch/data
    environment:
        discovery.zen.ping.unicast.hosts: elasticsearch1

volumes:
  esdata1:
    driver: local
  esdata2:
    driver: local
